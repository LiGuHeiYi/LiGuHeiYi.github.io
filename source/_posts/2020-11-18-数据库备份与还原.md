---
layout: post
title: MySQL数据库备份与还原
date: 2020-11-18
categories: blog
tags: [web,数据库]
description: 一个有用小知识
typora-copy-images-to: ..\img
---



# MySQL数据库备份与还原



```
数据库文件默认在：cd /usr/share/mysql
配置文件默认在：/etc/my.cnf

数据库目录：/var/lib/mysql/
配置文件：/usr/share/mysql(mysql.server命令及配置文件)
相关命令：/usr/bin(mysqladmin、mysqldump等命令)(*mysql的一种安全启动方式：/usr/bin/mysqld_safe –user=root &)
启动脚本：/etc/rc.d/init.d/
```

你可以使用以下的命令来寻找MySQL：

```
[root@stuhome /]# find / -name “mysql” -print
或
whereis mysql
```



一般来说mysql是放在/usr/local/mysql/下的。
然后在其bin目录下有个mysql_config文件，vim，会看见这么一句：

```
ldata=’/usr/local/mysql/var’
```

 

rpm安装默认目录：

```
数据文件：/var/lib/mysql/
配置文件模板：/usr/share/mysql
mysql客户端工具目录：/usr/bin
日志目录：/var/log/
pid，sock文件目录：/tmp/
```



## **备份数据库和还原MySQL**

备份和还原MySQL数据库的步骤：

### **如何使用CLI备份数据库**

使用MySQL提供的mysqldump工具，备份或导出MySQL数据库非常容易。
```
mysqldump -u[uname] -p[pass] [dbname] > [backupfile].sql
```
- [uname] - 是有权访问数据库的用户的名称；
- [pass] - 用户密码；
- [dbname] - 是要备份或导出的数据库的名称；
- [backupfile] - 是备份文件的名称。

提供一个示例数据库配置，比如要将linuxidc这个数据库导出为一个文件名为linuxidc-back.sql的数据库文件到当前目录下，则输入下面的命令：

[liloong@localhost ~/www.linuxidc.com]$mysqldump -uroot -proot mysql > mysql-back.sql

用户名：root  密码：root 数据库名：mysql  备份的数据库为：mysql-back.sql

需要注意的地方是：-p后面直接跟用户名和密码，不要有空格。

### **如何使用CLI还原数据库**

恢复或导入我们先前备份的MySQL数据库文件的另一种方法是使用mysql就像备份或导出数据库一样简单。
```
mysql -u[uname] -p[pass] [dbname] < [backupfile].sql
```
- [uname] - 是有权访问数据库的用户名；
- [pass] - 用户密码；
- [dbname] - 是要还原或导入的数据库的名称；
- [backupfile] - 是还原文件的名称。

给出一个数据库还原示例，如下所示：

[linuxidc@localhost ~/www.linuxidc.com]$mysqldump -uroot -pv linuxidc < linuxidc-back.sql

![备份和还原MySQL数据库的简便方法](https://www.linuxidc.com/upload/2020_03/20030313493957.png)

### **其他命令参考:**

备份远程MySQL数据库的命令
```
mysqldump -h[hostname] -u[username] -p[password] [databasename] > backupfile.sql
```
备份MySQL数据库为带删除表的格式备份MySQL数据库为带删除表的格式，能够让该备份覆盖已有数据库而不需要手动删除原有数据库。
```
mysqldump ---add-drop-table -u[username] -p[password] [databasename] > backupfile.sql
```
（远程）直接将MySQL数据库压缩备份
```
mysqldump -h[hostname] -u[username] -p[password] [databasename] | gzip > backupfile.sql.gz
```
（远程）备份MySQL数据库某个(些)表
```
mysqldump -h[hostname] -u[username] -p[password] [databasename] [table1 table2] > backupfile.sql
```
（远程）同时备份多个MySQL数据库
```
mysqldump -h[hostname] -u[username] -p[password] --databases [databasename1 databasename2 databasename3] > multibackupfile.sql
```
仅仅备份数据库结构
```
mysqldump -u[username] -p[password] --no-data --databases [databasename1 databasename2 databasename3] > structurebackupfile.sql
```
备份服务器上所有数据库
```
mysqldump -u[username] -p[password] --all-databases > allbackupfile.sql
```
（远程）还原MySQL数据库的命令
```
mysql -h[hostname] -u[username] -p[password] [databasename] < backupfile.sql
```
还原压缩的MySQL数据库
```
gunzip < backupfile.sql.gz | mysql -u[username] -p[password] [databasename]
```



### 简单粗暴的方法

**备份，直接复制整个数据库目录**

　　MySQL有一种非常简单的备份方法，就是将MySQL中的数据库文件直接复制出来。这是最简单，速度最快的方法。

不过在此之前，要先将服务器停止，这样才可以保证在复制期间数据库的数据不会发生变化。如果在复制数据库的过程中还有数据写入，就会造成数据不一致。这种情况在开发环境可以，但是在生产环境中很难允许备份服务器。

　　注意：这种方法不适用于InnoDB存储引擎的表，而对于MyISAM存储引擎的表很方便。同时，还原时MySQL的版本最好相同。

**还原，直接替换复制目录的备份**

 　　通过这种方式还原时，必须保证两个MySQL数据库的版本号是相同的。MyISAM类型的表有效，对于InnoDB类型的表不可用，InnoDB表的表空间不能直接复制。