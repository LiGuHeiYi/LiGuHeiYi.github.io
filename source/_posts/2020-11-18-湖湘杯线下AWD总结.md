---
layout: post
title: 湖湘杯AWD线下赛总结
date: 2020-11-18
categories: blog
tags: [web,AWD]
description: 总结？总结个屁，老子就是去挨打的。
typora-root-url: ..
---



# 湖湘杯AWD线下赛总结

第一次参加线下赛，之前看了很多资料做了很多准备，心里也确实紧张，去之前心里一直非常焦灼。

对于没把握的事非常非常紧张，这或许是我个人的一个重大缺点，经常使我难以良好的做到临场发挥，并且在行动之前自暴自弃。

比赛分上午下午两场，上午是线下做题模式，下午是AWD攻防。

上午的做题给了提交平台的ip地址和本队的用户名密码，还有靶机ip。

我们的主机是用一根网线连进了一个198开头的局域网里，靶机在172，这两个局域网连接起来的。

刚开始真的很懵，没料到还有这一出，以为上午下午都是攻防。突然来这一出，导致一开始没有想到要连靶机，就是埋着头硬写题。

第一个flag是经典送分题，御剑扫一下目录，发现目录下wwwroot.zip文件，直接给源码 ，下载下来主目录就有一个名为flag的无后缀文件，出于谨慎考虑，我还放kali里file了一下文件类型，发现是text，然后直接改后缀为txt，得到flag，这时队友已经提交了。

然后就是robots.txt，内容是

```
disallow:/admin/
```

不允许访问admin目录

看一看源文件，主页是index.php,于是改url为 http://ip/index.php/admin/ ，成功来到管理员登陆界面。

sqlmap注入失败，burpsuite暴破失败。队友找到了runtime目录下的log文件，结果由于我做题经验稀缺，一直被那个虚假的admin用户密码迷惑，又不敢直接否定或肯定自己的思路，费了很多时间，赛后大佬告诉我账号密码就在那个log文件里，只是我没找对地方而已。

![](/img/image-20201117181349246.png)

下午AWD攻防，前半个小时加固，备份靶机，然后开放攻击。之前我们都没参加过AWD，不知道该怎么办，就准备了很多攻击防御框架，脚本。

然而实战怎么没用上。又很多问题遇到了以后不太敢搞，然后队友会的我也会，我不会的队友也不会，配合性也很差。

过程没啥好说，直接总结问题：

### 一、

其实要第一时间准备好的东西其实不是什么攻击脚本，流量监控脚本，那东西变数太大。

要准备的是：个人shell，不死马文件，记事本打开，虚拟机打开，蚁剑打开，工作目录准备好

起手工作其实要做的就是把所有能提前准备好的东西准备好，得以让比赛开始后省去不必要的时间开销。开放攻击前的半个小时

就是争分夺秒，时间就是生命。改ssh密码，备份网站目录，备份数据库，D盾查杀木马，上传自己的🐎，这全要一气呵成，在攻击开放前搞完，否则大佬的批量化攻击脚本会瞬间攻陷你的主机，另一队的靶机1的数据库早早就被删了，我们运气好，被删的晚。

这里放一下数据库备份还原方法：



**如何使用CLI备份数据库**

使用MySQL提供的mysqldump工具，备份或导出MySQL数据库非常容易。

```shell
mysqldump -u[uname] -p[pass] [dbname] > [backupfile].sql
```



- [uname] - 是有权访问数据库的用户的名称；
- [pass] - 用户密码；
- [dbname] - 是要备份或导出的数据库的名称；
- [backupfile] - 是备份文件的名称。

提供一个示例数据库配置，比如要将mysql这个数据库导出为一个文件名为mysql-back.sql的数据库文件到当前目录下，则输入下面的命令：

```shell
[liloong@localhost ~/Backup]$mysqldump -uroot -proot mysql > mysql-back.sql
```

用户名：root  密码：root 数据库名：mysql  备份的数据库为：mysql-back.sql

需要注意的地方是：-p后面直接跟用户名和密码，不要有空格。但-u后面可以有。

**如何使用CLI还原数据库**

恢复或导入我们先前备份的MySQL数据库文件的另一种方法是使用mysql就像备份或导出数据库一样简单。

```php
mysql -u[uname] -p[pass] [dbname] < [backupfile].sql
```



- [uname] - 是有权访问数据库的用户名；
- [pass] - 用户密码；
- [dbname] - 是要还原或导入的数据库的名称；
- [backupfile] - 是还原文件的名称。

然后攻击就开始了，第一件事，扫对手的IP，所以kali可以早早的开好，把命令也准备好，开放以后直接用nmap或者赶时间用masscan扫，扫出来以后甚至可以尝试用ssh默认密码或靶机里原始的shell密码批量连接一下，因为真的有人不知道改ssh密码的！

### 二、挖洞

这次比赛，防御不防御的根本不是最重要的，最重要的是攻击！一个别人没有审计出的漏洞几乎就可以抵消大佬对你造成的所有伤害了。

**代码审计！**要加强！**挖洞**！这才是AWD的核心！

什么批量化脚本，什么流量监控，在我们现在这个阶段就是空话！真正的大佬都是现场写脚本的！要想把这些脚本用好，下次得把它们的源码研究了，了解了原理，才能最大限度地发挥作用。

而只要挖到了一个大部分人没掌握的洞，后续输出就像割韭菜一样。



### 三、技术细节

有很技术细节真的是不来参加一次比赛接触不到的。

比如不死马。其原理和克制方法，网上一查，全都说的头头是道的，实际操作起来可能完全不一样。比如这次，网上说使用

```shell
ps aux
```

命令查看进程，然后 

```shell
kill -9 [PID]
```

杀进程，就能把不死马进程杀掉了。然而，不死马进程的权限是www-data用户的，我们所使用的赛方提供的ubuntu用户根本杀不了它的进程，又或是由于它在不断动态生成，导致进程的PID一直在变(这一段不知道说的对不对)。反正它显示，“不存在该PID的进程”。

但赛后大佬说直接杀掉全部apache2进程就行了，利用自己传的shell执行命令

```shell
killall apache2
```

直接让apache2重启，所有相关进程自然没有了

还有大佬说这次主办方直接在靶机里留了Busybox,

![](/img/image-20201117211912516.png)

使用

```shell
/bin/busybox sh
```

使用busybox,就可以随便搞了，任意执行命令，这样就可以执行比赛前准备的第三方脚本而不用担心没有权限了。

又或者，如果没有执行权限，可以先给要执行的文件+x，然后用scp命令传上靶机，因为scp命令是带权限复制的（又是一个非常有用的小细节）



然后，我们这次没扫出对面ip ,完全是我自己傻逼了的原因。因为之前没用过nmap和masscan, 完全通过文档学习。一开始扫不出东西，我还以为是我命令输错 了，懵逼了好久，然后后来想到了可能D段里没有别的主机了，不同选手的靶机可能在不同的C段，然后nmap扫，扫了快十分钟没扫出来（后来知道选手的靶机在100-150），放弃了，主要是当时心态炸了。

这次知道了我操作的没问题，下次就会自信多了



这次的AWD只能说惨淡收场，但明年再战的时候，必重拳出击