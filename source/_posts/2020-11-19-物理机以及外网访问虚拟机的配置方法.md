---
layout: post
title: 物理机以及外网访问虚拟机的配置方法
date: 2020-11-19
categories: blog
tags: [web,虚拟机]
description: 一个有用小知识
typora-copy-images-to: ..\img
---

# 物理机以及外网访问虚拟机的配置方法

vmware虚拟机的虚拟网络配置有有三种模式：桥接、NAT和Host-Only。

一般情况下，这三种方式都能被物理主机访问，但只有桥接和NAT模式能够被外网访问。三种网络模式我在下篇文章再写，这篇文章记录一下配置桥接模式和NAT模式，让物理机和外网能够访问虚拟机的方法。

### 桥接模式

桥接模式是指本地物理网卡和虚拟网卡通过VMnet0虚拟交换机进行桥接，物理网卡和虚拟网卡在拓扑图上处于同等地位，那么物理网卡和虚拟网卡就相当于处于同一个网段，虚拟交换机就相当于一台现实网络中的交换机,所以两个网卡的IP地址也要设置为同一网段。

也就是说相当于这时虚拟机和物理机同为局域网中的一个主机，他们在同一个D段里，也就是ip的前三段都是一样的，最后一段不同

![image-20201119212813213](\img\image-20201119212813214.png)

点击右下角的“更改设置”

![image-20201119212927918](\img\image-20201119212927918.png)

如果在局域网中使用，这里直接默认自动设置就行（会自动分配局域网ip以及dns服务器），点击最上面的桥接模式然后点击右下角的应用即可

如果试图在公网中使用，那么它需要你给它手动分配一个你个人使用的公网ip，然后设置好dns服务器

测试一下访问情况

![](\img\QQ图片20201119213724.png)

这是ubuntu虚拟机本地访问localhost界面，并且查看到虚拟机的局域网ip为192.168.43.159



![](\img\QQ图片20201119213759.png)

这是使用192.168.43.159这个ip在物理主机上访问的结果，成功访问到ubuntu主页

桥接模式访问成功

### NAT模式

NAT模式，就是让虚拟机借助NAT(网络地址转换)功能，通过宿主机器所在的网络来访问公网。

NAT模式中，虚拟机的网卡和物理网卡的网络，不在同一个网络，虚拟机的网卡，是在vmware提供的一个虚拟网络。

 可以理解为：虚拟机处于物理机中vmware配置的一个虚拟局域网里，大概可以理解为这样的一个层次关系：

公网——>路由——>局域网——>物理主机——>vmware虚拟网络——>虚拟机

也就是说，这时，外网或局域网能够访问到物理主机，物理主机和虚拟机也都能正常访问外网和局域网，而且用的是一个局域网IP。

但在没有建立网络映射的情况下，外网和局域网不能通过物理主机访问到虚拟机。

其实外网访问物理主机也是一样的，如果没有路由和交换机构建的网络映射，外网也同样无法通过路由的公网ip访问到物理主机。

所以，只要模拟路由器在物理主机和虚拟机之间构建好网络映射，就能同过物理机ip和特定端口访问到虚拟机了。

![image-20201119222136524](\img\image-20201119222136524.png)

点击右边的NAT设置，配置主机和虚拟机的端口映射

![image-20201119223052918](\img\image-20201119223052918.png)

上面我将虚拟机的80端口映射到了物理机的8000端口上，也就是说，只要开启虚拟机的apache服务，就可以通过访问 *http://物理机ip:8000* 这个地址，访问到虚拟机网站服务。

另外一个网站服务类同。

测试一下

![](\img\QQ图片20201119213503.png)

ubuntu本地访问

![img](\img\3V6V_D2AAG9VSZG$REMH4KI.png)

查看物理机IP：192.168.43.150

![img](\img\3@N8QYWOA@RJ[ZHAQC2M36.png)

![](\img\QQ图片20201119223825.png)

物理机上浏览器使用本机ip加8000端口访问ubuntu网站服务成功