---
layout: post
title: php连接mysql
date: 2020-9-29
categories: blog
tags: [php,MySQL]
description: 如何将php页面与mysql数据库连接起来并输入指令
---

# php连接MySQL

在本地网站建一个这样的index.php,就能连接到本地MySQL服务器了，以下代码纯手撸~

```php+HTML
<?php
if($_POST['servername']&&$_POST['username']&&$_POST['passwd'])
{
        $servername=$_POST['servername'];
        $username=$_POST['username'];
        $password=$_POST['passwd'];
// $dbname=$_GET['dbname'];

        $sql = new mysqli($servername,$username,$password);
        if($sql->connect_error)
        {
                die("连接失败：".$sql->connect_error);
        }
        else
        {
                die("连接成功,5秒后跳转到命令输入界面");
                sleep(5);
                header('Location: cmd.php');
                exit;
// $require="INSERT INTO Student (name,number,class) VALUES ('Li','8074','2班');";

// $sql->query($require);
        }
}
else
{
?>
<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>连接数据库</title>
</head>
<body>
        <p>
        请输入服务器，用户名以及密码
        </p>
        <form action="index.php" method="post">
        服务器：<input type="text" name="servername">
        用户名：<input type="text" name="username">
        密码：<input type="password" name="passwd">
        <input type="submit" value="提交">
        </form>
</body>
</html>
<?php
}
?>
```

访问页面

![](\img\连接数据库.png)

这里输入啥就可以登陆啥了，我这里以root用户登录localhost

连接成功！

![](\img\连接成功.png)

我这里设计了一个可以提交mysql命令的页面（注入漏洞警告！）

![](\img\提交命令.png)

提交以后，嘻嘻，这样就没法注入了吧

![](\img\成功了也不给你看.png)

cmd.php的源码

```php+HTML
<?php

$servername='localhost';
$username='root';
$password='root';
// $dbname=$_GET['dbname'];

$sql = new mysqli($servername,$username,$password);
if($_GET['cmd'])
{
        $cmd=$_GET['cmd'];
        if($sql->query($cmd))
        {
                echo "命令执行成功，但我就不给你看结果,嘻嘻";
        }
        else{
                echo "执行失败"."Error:".$sql->error;
        }
}
else{
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>输入SQL命令</title>
</head>
<body>
<p>
输入SQL命令：
</p>
<form action="cmd.php" mothod="get">
<input type="text" name="cmd" value="USE mysql">
<input type="submit" value="提交">
</form>
</body>
</html>
<?php
}
?>
```

实际上，应该用session来继承从index页面获得的数据，这里我偷个懒，用session的实现留到以后再说