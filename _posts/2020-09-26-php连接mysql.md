---
layout: post
title: php连接mysql
date: 2020-9-29
categories: blog
tags: [php,MySQL]
description: 如何将php页面与mysql数据库连接起来并输入指令
---

# php连接MySQL

## 用mysqli以面向对象的方式连接mysql数据库

在本地网站建一个这样的index.php,就能连接到本地MySQL服务器了，以下代码纯手撸~ 可以自行输入服务器名，用户，密码

```php+HTML
<?php
if($_POST['servername']&&$_POST['username']&&$_POST['passwd'])
{
        $servername=$_POST['servername'];
        $username=$_POST['username'];
        $password=$_POST['passwd'];
// $dbname=$_GET['dbname'];

        $sql = new mysqli($servername,$username,$password);
        if($sql->connect_error)
        {
                die("连接失败：".$sql->connect_error);
        }
        else
        {
                echo "<script>alert(\"连接成功\")</script>";
                // header('Location:cmd.php');
                // exit;
                $url = "cmd.php";
                echo "<script language='javascript' type='text/javascript'>";
                echo "window.location.href='$url'";
                echo "</script>";
        }
}
else
{
?>
<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>连接数据库</title>
</head>
<body>
        <p>
        请输入服务器，用户名以及密码
        </p>
        <form action="index.php" method="post">
        服务器：<input type="text" name="servername">
        用户名：<input type="text" name="username">
        密码：<input type="password" name="passwd">
        <input type="submit" value="提交">
        </form>
        <p id="success">
        </p>
</body>
</html>
<?php
}
?>
```

访问页面

![](\img\连接数据库.png)

这里输入啥就可以登陆啥了，我这里以root用户登录localhost

连接成功！

![](E:\文档\Github仓库\LiGuHeiYi\LiGuHeiYi.github.io\img\连接成功.png)

我这里设计了一个可以提交mysql命令的页面（注入漏洞警告！）

![](\img\提交命令.png)

提交以后，嘻嘻，这样就没法注入了吧

![](\img\成功了也不给你看.png)

cmd.php的源码

```php+HTML
<?php

$servername='localhost';
$username='root';
$password='root';
// $dbname=$_GET['dbname'];

$sql = new mysqli($servername,$username,$password);
if($_GET['cmd'])
{
        $cmd=$_GET['cmd'];
        if($sql->query($cmd))
        {
                echo "命令执行成功，但我就不给你看结果,嘻嘻";
        }
        else{
                echo "执行失败"."Error:".$sql->error;
        }
}
else{
?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>输入SQL命令</title>
</head>
<body>
<p>
输入SQL命令：
</p>
<form action="cmd.php" mothod="get">
<input type="text" name="cmd" value="USE mysql">
<input type="submit" value="提交">
</form>
</body>
</html>
<?php
}
?>
```

实际上，应该用session来继承从index页面获得的数据，这里我偷个懒，用session的实现留到以后再说

。。。

好的，三天过去了。我来接着水用cookie或session来实现的方法了



## 用PDO连接mysql数据库

在Windows用pdo之前需要在php.ini里，将pdo拓展打开，具体方法是将# extension = php_pdo.dll这一行注释去掉(phpstudy已经做完了这一步)，然后需要连接哪种数据库就再去掉哪种数据库的注释。PDO(php database object)最大的优点就是可以连接不止mysql这一种数据库，比较方便的地方是可以使用异常类来处理程序运行时出现的问题，像下面代码可以将执行部分放在try{}模块中，发生异常直接获得信息，不用像上面sqli一样每次都判断一下执行是否成功

```php
<?php
$servername = "localhost";
$username = "root";
$password = "root";

try {
    $conn = new PDO("mysql:host=$servername;", $username, $password);//建立连接对象
    echo "连接成功";
}
catch(PDOException $e)
{
    echo $e->getMessage();
}
?>
```

还是放到phpstudy的本地网站里，打开网站

![](E:\文档\Github仓库\LiGuHeiYi\LiGuHeiYi.github.io\img\pdo connect.png)



## 关闭连接

连接在脚本执行完后会自动关闭。你也可以使用以下代码来关闭连接：

#### 实例 (MySQLi - 面向对象)

```php
$conn->close();
```



#### 实例 (MySQLi - 面向过程)

```php
mysqli_close($conn);
```



#### 实例 (PDO)

```php
$conn = null;
```

