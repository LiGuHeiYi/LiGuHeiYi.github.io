---
layout: post
title:ctf中的信息泄露
date: 2021-1-11
categories: blog
tags: [ctf,web]
description: 详解ctf中的信息泄露
typora-copy-images-to: ..\img
typora-root-url: ..
---
# 信息泄露总结

## 目录遍历

顾名思义，就是翻找目录。查找目录中的有用信息。一般来说要结合dirsearch或御剑等工具来进行查找。

## phpinfo

在可以“有限”地执行php命令地地方执行phpinfo()函数，可以得到服务器php配置的信息，比如：环境变量，可用模块，网站绝对路径，服务器操作系统，使用的组件等，为之后的操作提供思路和帮助。

## 备份文件下载

### 网站源码泄露

当开发人员在线上环境中对源代码进行了备份操作，并且不小心将备份文件放在了 web 目录下，就会引起网站源码泄露。

常见的的文件名：

www

wwwroot

back

backup

web

website

temp

常见的后缀：

zip

rar

tar

tar.gz

### bak文件

有些时候网站管理员可能为了方便，会在修改某个文件的时候先复制一份，将其命名为xxx.bak。而大部分Web Server对bak文件并不做任何处理，导致可以直接下载，从而获取到网站某个或某部分文件的源代码。

即：文件名后面加后缀 .bak

### vim缓存

当开发人员在线上环境中使用 vim 编辑器，在使用过程中会留下 vim 编辑器缓存，当vim异常退出时，缓存会一直留在服务器上，引起网站源码泄露。

 

非正常关闭vim编辑器时会生成一个.swp文件

在使用vim时会创建临时缓存文件，关闭vim时缓存文件则会被删除，当vim异常退出后，因为未处理缓存文件，导致可以通过缓存文件恢复原始文件内容。

以 index.php 为例：

第一次产生的交换文件名为 .index.php.swp

再次意外退出后，将会产生名为 .index.php.swo 的交换文件

第三次产生的交换文件则为 .index.php.swn。

可以放到linux系统中使用vim工具加参数 -r修复此备份文件并打开

### .DS_Store文件

.DS_Store 是 Mac OS 保存文件夹的自定义属性的隐藏文件。

**通过.DS_Store可以知道这个目录里面所有文件的清单。**

.DS_Store可以直接使用记事本打开，但是打开后乱码居多；也可以使用 Python-dsstore 这个工具 (https://github.com/gehaxelt/Python-dsstore)  来完成 .DS_Store 文件的解析，直观一些。



## 版本控制系统有关的泄露（Git、SVN、HG）

### 版本控制系统

集中式版本控制系统：Subversion(SVN)、CVS、VSS 等。
分布式版本控制系统：Git、Mercurial(Hg) 等。

对于各个版本控制系统的区别的分析介绍:https://www.cnblogs.com/likebeta/archive/2012/12/18/2822805.html

## Git泄露

漏洞成因：在运行git init初始化代码库的时候，会在当前目录下面产生一个.git的隐藏文件，用来记录代码的变更记录等等。在发布代码的时候，把.git这个目录没有删除，直接发布了。使用这个文件，可以用来恢复源代码。


1.漏洞利用：工具：GitHack （https://github.com/BugScanTeam/GitHack） 或 dvcs-ripper （https://github.com/kost/dvcs-ripper）

**GitHack**

使用方法：

```
python2 GitHack.py URL/.git/
```

**dvcs-ripper**

使用方法:

Example run (for git):
```bash
rip-git.pl -v -u URL/.git/

It will automatically do git checkout -f
```

or if you would like to ignore SSL certification verification (with -s):
```bash
rip-git.pl -s -v -u http://www.example.com/.git/
```

![Git常用命令](/img/20200825145004389.jpg)

### log

log即指git中的日志，通过 `git log`命令来查看该项目的日志，然后用`git diff `命令来查看现版本和之前版本有什么不同，或者用`git reset`命令直接回到该版本。

### stash

stash就相当于一个临时储存列表，当程序员想要调试该版本又不想丢掉之前某个版本的时候，就可以使用`git stash`命令将本地修改保存起来，并回到之前的版本。

```bash
通过git stash存储的修改列表,可以通过git stash list查看.

git stash show用于校验.

git stash apply用于重新存储.

直接执行git stash等同于git stash save.
```

最新的存储保存在refs/stash中.老的存储可以通过相关的参数获得,例如stash@{0}获取最新的存储,stash@{1}获取次新.stash@{2.hour.ago}获取两小时之前的.存储可以直接通过索引的位置来获得stash@{n}.

步骤：

1.用`git stash list`命令查看储存列表

2.用`git stash show`查看该版本有什么不同

3.用`git stash pop stash@{n}`来释放这个版本，n为要释放的版本的索引。

### index

index是Git本地库中的索引，是一个二进制文件。索引中包含一个列表，列表根据文件名、文件模式和文件元数据进行了排序，以便快速检测文件的变化。

索引中还包含所有Blob类型的SHA-1标识符。

> **Git文件状态**
>
> 对于新创建的一个文件，其状态为untracked。
>
> 通过git add ...命令，可以将该新建文件的状态转换为staged，这个过程就是将新建文件加入到Index中。
>
> 通过git commit命令，可以将处于staged状态的文件提交到本地库的HEAD。

**关键**

`git checkout-index`命令

**将Index中列表的文件检出到工作目录，默认不覆盖已有文件**。



- -u, --index，更新所有检出的文件的stat信息（git status）
- -a, --all，检出Index中列表的所有文件
- -f, --force，检出时覆盖已有文件
- -n, --no-create，只再次检出工作目录中已有的文件（不创建任何新文件）
- --，禁用任何参数

例如：

- 从Index检出已有文件的最新版本，并覆盖

```
git checkout-index -n -f
```

- 检出全部文件到git-export-dir目录

```
git checkout-index -a --prefix=git-export-dir/
```

- 检出文件Makefile，并重命名为.merged-Makefile

```
git checkout-index --prefix=.merged- Makefile
```

**可能有用**

1. `git update-index`命令
    将工作目录中的文件加入到index列表中。
    不建议使用该命令，同样情况下推荐使用git add

如下命令完全等价：

- 为myFile文件设置可执行权限

```
git add --chmod=+x myFile
git update-index --chmod=+x myFile
```

- 为myFile文件撤销可执行权限

```
git add --chmod=-x myFilegit update-index --chmod=-x myFile
```



2. `git merge-index`命令
 为Index中需要合并的文件执行合并操作。
 基本用法：

```
git merge-index [-o] [-q] <merge-program> (-a | [--] <file>*)
```

示例：

```
git merge-index cat a_script_file
```



Git的内容挺多的，以上只涉及到了跟CTF有关的内容，以后有机会还得深入了解学习一下。

## SVN泄露

> 当开发人员使用 SVN （Subversion）进行版本控制，对站点自动部署。如果配置不当,可能会将.svn文件夹直接部署到线上环境。这就引起了 SVN 泄露漏洞。

使用工具dvcs-ripper  链接：https://github.com/kost/dvcs-ripper

在windows上使用没成功，环境不对，安装了active Perl也不行，还缺少个SQLite和什么东西，于是直接在kali上使用好了

- 安装：`sudo apt-get install perl libio-socket-ssl-perl libdbd-sqlite3-perl libclass-dbi-perl libio-all-lwp-perl`
- gitclone: `git clone https://github.com/kost/dvcs-ripper`
- 进入目录
- 命令： `./rip-svn.pl -v -u http://www.example.com/.svn/`

然后会克隆下来一个.svn文件夹，默认是隐藏文件夹，按Ctrl+H显示，之后自行寻找.svn文件夹中关于flag的线索即可

## HG泄露

> **Mercurial**是[跨平台](https://zh.wikipedia.org/wiki/跨平台)的[分布式版本控制](https://zh.wikipedia.org/wiki/分布式版本控制)软件，主要由[Python](https://zh.wikipedia.org/wiki/Python)语言实现，但也包含用[C语言](https://zh.wikipedia.org/wiki/C语言)实现的二进制比较工具。Mercurial一开始的主要运行平台是[Linux](https://zh.wikipedia.org/wiki/Linux)，现在Mercurial已经移植到[Windows](https://zh.wikipedia.org/wiki/Windows)、[Mac OS X](https://zh.wikipedia.org/wiki/Mac_OS_X)和大多数的[类Unix](https://zh.wikipedia.org/wiki/类Unix)系统中。Mercurial主要由[命令行](https://zh.wikipedia.org/wiki/命令行界面)程序组成，现在也有了[图形用户界面](https://zh.wikipedia.org/wiki/图形用户界面)。对Mercurial的所有操作都由用不同的关键字作为参数调用程序“hg”来实现，Hg是参考[水银](https://zh.wikipedia.org/wiki/水银)的[化学符号](https://zh.wikipedia.org/wiki/化学符号)而取的名字。

当开发人员使用 Mercurial 进行版本控制，对站点自动部署。如果配置不当,可能会将.hg 文件夹直接部署到线上环境。这就引起了 hg 泄露漏洞。

仍然使用dvcs-ripper工具将.hg文件夹克隆到本地。然后可以使用命令查找 ，也可以使用手工查找。

遇到这种版本控制系统的信息泄露情况，如果会使用这些版本空控制系统，显然会有很多的好处。如果不熟悉它们的话，也不用太过担心，很多时候手工也能找到有用信息。不过有机会还是学习使用一下这些版本控制系统，或者了解一些原理和命令好了，毕竟没有坏处。

## CVS泄露

还是使用dvcs-ripper工具克隆然后分析。

以后有机会详细学习记录一下这几个常见的版本控制系统吧。