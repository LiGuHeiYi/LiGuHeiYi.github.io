---
layout: post
title: 现阶段计算机网络知识笔记以及整合（不断整合）
date: 2020-11-21
categories: blog
tags: [web,计算机网络]
description: 一些笼统的计算机网络知识，有疏漏或错误之处等我刷了《计算机网络》以后再回来修改补齐
typora-copy-images-to: ..\img
typora-root-url: ..
---

# 现阶段计算机网络知识笔记以及整合



## OSI网络参考模型

**开放式系统互联模型**（英语：**O**pen **S**ystem **I**nterconnection Model，缩写：OSI；简称为**OSI模型**）是一种[概念模型](https://zh.wikipedia.org/wiki/概念模型)，由[国际标准化组织](https://zh.wikipedia.org/wiki/国际标准化组织)提出，一个试图使各种计算机在世界范围内互连为网络的标准框架。定义于ISO/IEC 7498-1。

根据建议X.200，OSI将计算机网络体系结构划分为以下七层，标有1～7，第1层在底部。 现“OSI/RM”是[英文](https://zh.wikipedia.org/wiki/英文)“Open Systems Interconnection Reference Model”的缩写。

PS:这只是一种参考模型

### 第7层 应用层

主条目：[应用层](https://zh.wikipedia.org/wiki/应用层)

应用层（Application Layer）提供为应用软件而设计的接口，以设置与另一应用软件之间的通信。例如：HTTP、HTTPS、FTP、Telnet、SSH、SMTP、POP3等。

### 第6层 表示层

主条目：[表示层](https://zh.wikipedia.org/wiki/表示层)

表示层（Presentation Layer）把数据转换为能与接收者的系统格式兼容并适合传输的格式。

### 第5层 会话层

主条目：[会话层](https://zh.wikipedia.org/wiki/会话层)

会话层（Session Layer）负责在数据传输中设置和维护计算机网络中两台计算机之间的通信连接。

### 第4层 传输层

主条目：[传输层](https://zh.wikipedia.org/wiki/传输层)

传输层（Transport Layer）把传输表头（TH）加至数据以形成数据包。传输表头包含了所使用的协议等发送信息。例如:传输控制协议（TCP）等。

### 第3层 网络层

主条目：[网络层](https://zh.wikipedia.org/wiki/网络层)

网络层（Network Layer）决定数据的路径选择和转寄，将网络表头（NH）加至数据包，以形成报文。网络表头包含了网络资料。例如:互联网协议（IP）等。

### 第2层 数据链路层

主条目：[数据链路层](https://zh.wikipedia.org/wiki/数据链路层)

数据链路层（Data Link Layer）负责网络寻址、错误侦测和改错。当表头和表尾被加至数据包时，会形成[信息框](https://zh.wikipedia.org/wiki/資訊框)（Data Frame）。数据链表头（DLH）是包含了物理地址和错误侦测及改错的方法。数据链表尾（DLT）是一串指示数据包末端的字符串。例如以太网、无线局域网（Wi-Fi）和通用分组无线服务（GPRS）等。

分为两个子层：逻辑链路控制（logical link control，LLC）子层和介质访问控制（Media access control，MAC）子层。

### 第1层 物理层

主条目：[物理层](https://zh.wikipedia.org/wiki/物理层)

物理层（Physical Layer）在局部局域网上传送[数据帧](https://zh.wikipedia.org/wiki/数据帧)（Data Frame），它负责管理电脑通信设备和网络媒体之间的互通。包括了针脚、电压、线缆规范、集线器、中继器、网卡、主机接口卡等。



## TCP/IP协议族

TCP/IP 是基于 TCP 和 IP 这两个最初的协议之上的不同的通信协议的大集合。

里面有：

#### TCP - 传输控制协议

TCP 用于从应用程序到网络的数据传输控制。

TCP 负责在数据传送之前将它们分割为 IP 包，然后在它们到达的时候将它们重组。

------

#### IP - 网际协议（Internet Protocol）

IP 负责计算机之间的通信。

IP 负责在因特网上发送和接收数据包。

------

#### HTTP - 超文本传输协议(Hyper Text Transfer Protocol)

HTTP 负责 web 服务器与 web 浏览器之间的通信。

HTTP 用于从 web 客户端（浏览器）向 web 服务器发送请求，并从 web 服务器向 web 客户端返回内容（网页）。

------

#### HTTPS - 安全的 HTTP（HTTP Secure）

HTTPS 负责在 web 服务器和 web 浏览器之间的安全通信。

作为有代表性的应用，HTTPS 会用于处理信用卡交易和其他的敏感数据。

------

#### SSL - 安全套接字层（Secure Sockets Layer）

SSL 协议用于为安全数据传输加密数据。

------

#### SMTP - 简易邮件传输协议（Simple Mail Transfer Protocol）

SMTP 用于电子邮件的传输。

------

#### MIME - 多用途因特网邮件扩展（Multi-purpose Internet Mail Extensions）

MIME 协议使 SMTP 有能力通过 TCP/IP 网络传输多媒体文件，包括声音、视频和二进制数据。

------

#### IMAP - 因特网消息访问协议（Internet Message Access Protocol）

IMAP 用于存储和取回电子邮件。

------

#### POP - 邮局协议（Post Office Protocol）

POP 用于从电子邮件服务器向个人电脑下载电子邮件。

------

#### FTP - 文件传输协议（File Transfer Protocol）

FTP 负责计算机之间的文件传输。

------

#### NTP - 网络时间协议（Network Time Protocol）

NTP 用于在计算机之间同步时间（钟）。

------

#### DHCP - 动态主机配置协议（Dynamic Host Configuration Protocol）

DHCP 用于向网络中的计算机分配动态 IP 地址。

------

#### SNMP - 简单网络管理协议（Simple Network Management Protocol）

SNMP 用于计算机网络的管理。

------

#### LDAP - 轻量级的目录访问协议（Lightweight Directory Access Protocol）

LDAP 用于从因特网搜集关于用户和电子邮件地址的信息。

------

#### ICMP - 因特网消息控制协议（Internet Control Message Protocol）

ICMP 负责网络中的错误处理。

------

#### ARP - 地址解析协议（Address Resolution Protocol）

ARP - 用于通过 IP 来查找基于 IP 地址的计算机网卡的硬件地址。

------

#### RARP - 反向地址转换协议（Reverse Address Resolution Protocol）

RARP 用于通过 IP 查找基于硬件地址的计算机网卡的 IP 地址。

------

#### BOOTP - 自举协议（Boot Protocol）

BOOTP 用于从网络启动计算机。

------

#### PPTP - 点对点隧道协议（Point to Point Tunneling Protocol）

PPTP 用于私人网络之间的连接（隧道）。



## TCP/IP

TCP/IP 是用于因特网 (Internet) 的通信协议。

TCP/IP 是供已连接因特网的计算机进行通信的通信协议。

TCP/IP 指传输控制协议/网际协议（*T*ransmission *C*ontrol *P*rotocol / *I*nternet *P*rotocol）。

TCP/IP 定义了电子设备（比如计算机）如何连入因特网，以及数据如何在它们之间传输的标准。

### TCP 使用固定的连接

TCP 用于应用程序之间的通信。

当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方"握手"之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信。

这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。

UDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。

### IP 是无连接的

IP 用于计算机之间的通信。

IP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。这样，IP 就降低了对网络线路的需求。每条线可以同时满足许多不同的计算机之间的通信需要。

通过 IP，消息（或者其他数据）被分割为小的独立的包，并通过因特网在计算机之间传送。

IP 负责将每个包路由至它的目的地。

### **TCP/IP协同而分工工作**

TCP/IP 意味着 TCP 和 IP 在一起协同工作。但他们分工又十分分明，简单来说：

TCP 负责应用软件（比如浏览器）和网络软件之间的通信。

IP 负责计算机之间的通信。

TCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。

IP 负责将包发送至接受者。

#### TCP三次握手、四次挥手

------

- 所谓**三次握手**(Three-way Handshake)，是指建立一个TCP连接时，需要客户端和服务器总共发送3个数据包。



三次握手的目的是连接服务器指定端口，建立TCP连接,并同步连接双方的序列号和确认号并交换 TCP 窗口大小信息。
**第一次握手：**Client向Server发送SYN握手包（seq=x），进入SYN_SEND状态
**第二次握手：**Server返回SYN+ACK确认包(seq=y,ack=x+1)，进入SYN_RECV状态
**第三次握手：**Client再次发送ACK确认包(ack=y+1),此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。

完成三次握手，客户端与服务器开始传送数据。

#### 图文详解：

![100327002629](http://www.centos.bz/wp-content/uploads/2012/08/100327002629.png)
 第一次握手:
 客户端发送一个TCP的**SYN标志位置为1**的包（表明这是一个**SYN包**）指明客户打算连接的服务器的端口，以及**初始序号X**,保存在包头的序列号(**Seq**uence Number)字段里。
![100327002911](http://www.centos.bz/wp-content/uploads/2012/08/100327002911.png)
 第二次握手:
 服务器发回**SYN+ACK确认包**应答。即**SYN标志位和ACK标志位均为1**同时，将确认序号(**Ack**nowledgement Number)设置为客户的初始序号加1，即X+1。并设置这个SYN+ACK确认包的序列号（seq）为**Y**
![100327003054](http://www.centos.bz/wp-content/uploads/2012/08/100327003054.png)

第三次握手.
 客户端发送一个**ACK确认包**（ **SYN标志位为0,ACK标志位为1**）。并且把服务器发来SYN+ACK确认包的序列号（seq）字段+1,放在确认序号字段中发送给对方。
![100327003214](http://www.centos.bz/wp-content/uploads/2012/08/100327003214.png)

上面这个来回对对方发来的数据包的序列号seq的值+1再作为确认序号发送回去的过程，可以在一定程度上保证信息传递的完整性以及安全。

**SYN攻击**
   在三次握手过程中，服务器发送SYN-ACK之后，收到客户端的ACK之前的TCP连接称为半连接(half-open connect).此时服务器处于Syn_RECV状态.当收到ACK后，服务器转入ESTABLISHED状态.
  Syn攻击就是 攻击客户端  在短时间内伪造大量不存在的IP地址，向服务器不断地发送syn包，服务器回复确认包，并等待客户的确认，由于源地址是不存在的，服务器需要不断的重发直 至超时，这些伪造的SYN包将长时间占用未连接队列，正常的SYN请求被丢弃，目标系统运行缓慢，严重者引起网络堵塞甚至系统瘫痪。
 Syn攻击是一个典型的[DDOS](https://www.centos.bz/tag/ddos/)攻击。检测SYN攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击.在[Linux](http://www.centos.bz/)下可以如下命令检测是否被Syn攻击

```shell
netstat -n -p TCP | grep SYN_RECV
```

 一般较新的TCP/IP协议栈都对这一过程进行修正来防范Syn攻击，修改TCP协议实现。主要方法有SynAttackProtect保护机制、SYN cookies技术、增加最大半连接和缩短超时时间等.
 但是不能完全防范SYN攻击。



- 所谓**四次挥手**(four-way handshake)，是指拆除一个TCP连接时，需要客户端和服务器总共发送4个数据包。

与上面写的三次握手不同的是，客户端或服务器均可主动发起挥手动作。

**第一次挥手：**主动方发送一个FIN，用来关闭主动方到被动方的数据传送

**第二次挥手：**被动方收到这个FIN，它发回一个ACK，确认序号为收到的序号加1

这中间如果被动方还有数据没有发送完毕，可以继续发送，直到完成后，再接着进行第三次挥手（**这也是为什么握手只要三次，挥手却需要四次**）

**第三次挥手：**被动方关闭与主动方的连接，发送一个FIN给主动方

**第四次挥手：**主动方发回ACK报文确认，并将确认序号设置为收到序号加1

![100327022731](http://www.centos.bz/wp-content/uploads/2012/08/100327022731.jpg)

 一般较新的TCP/IP协议栈都对这一过程进行修正来防范Syn攻击，修改tcp协议实现。主要方法有SynAttackProtect保护机制、SYN cookies技术、增加最大半连接和缩短超时时间等.
 但是不能完全防范syn攻击。

上图有疏漏，最后一个ACK包中的ACK应当等于Y+1。



## IP地址（IPv4）

每个计算机必须有一个 IP 地址才能够连入因特网。

每个 IP 包必须有一个地址才能够发送到另一台计算机。

TCP/IP 使用 4 组数字（4个数字）来为计算机编址。每个计算机必须有一个唯一的 4 组数字的地址（IPv4地址）。

每组数字必须在 0 到 255（就是8位二进制数） 之间，并由点号隔开，比如：192.168.1.60。

所以一个ip地址实际上一个32位的二进制数，每八位用一个点号分开。

### IPv6

下一代ip协议，为了应对IPv4地址日渐消耗殆尽的问题而设计的。暂且不表，因为我还没仔细了解



## TCP/IP协议四层模型

TCP/IP协议是OSI体系结构的一种实现，但将OSI概念体系中的”会话层，表达层，应用层“合并为”应用层“，传输层和网络层基本不变，又将”数据链路层和物理层“归并成”网络接口层“，使其更简洁，便于实现。

### 链路层

以太网协议规定，接入网络的设备都必须安装网络适配器，即网卡，数据包必须是从一块网卡传送到另一块网卡。而网卡地址就是数据包的发送地址和接收地址，有了MAC地址以后，[以太网](https://baike.baidu.com/item/以太网/99684)采用广播形式，把数据包发给该子网内所有主机，子网内每台主机在接收到这个包以后，都会读取首部里的目标MAC地址，然后和自己的MAC地址进行对比，如果相同就做下一步处理，如果不同，就丢弃这个包。 [4] 

所以链路层的主要工作就是对电信号进行分组并形成具有特定意义的数据帧，然后以广播的形式通过物理介质发送给接收方。 [4] 



### 网络层

**IP协议**

网络层引入了IP协议，制定了一套新地址，使得我们能够区分两台主机是否同属一个网络，这套地址就是网络地址，也就是所谓的IP地址。IP协议将这个32位的地址分为两部分，前面部分代表网络地址，后面部分表示该主机在局域网中的地址。如果两个IP地址在同一个子网内，则网络地址一定相同。为了判断IP地址中的网络地址，IP协议还引入了子网掩码，IP地址和子网掩码通过按位与运算后就可以得到网络地址。 [4] 

**ARP协议**

即地址解析协议，是根据IP地址获取MAC地址的一个网络层协议。其工作原理如下：ARP首先会发起一个请求数据包，数据包的首部包含了目标主机的IP地址，然后这个数据包会在链路层进行再次包装，生成以太网数据包，最终由以太网广播给子网内的所有主机，每一台主机都会接收到这个数据包，并取出标头里的IP地址，然后和自己的IP地址进行比较，如果相同就返回自己的MAC地址，如果不同就丢弃该数据包。ARP接收返回消息，以此确定目标机的MAC地址；与此同时，ARP还会将返回的MAC地址与对应的IP地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。 [4] 

**路由协议**

首先通过IP协议来判断两台主机是否在同一个[子网](https://baike.baidu.com/item/子网/1186929)中，如果在同一个子网，就通过ARP协议查询对应的MAC地址，然后以广播的形式向该子网内的主机发送数据包；如果不在同一个子网，以太网会将该数据包转发给本子网的网关进行路由。[网关](https://baike.baidu.com/item/网关/98992)是[互联网](https://baike.baidu.com/item/互联网/199186)上子网与子网之间的桥梁，所以网关会进行多次转发，最终将该数据包转发到目标IP所在的子网中，然后再通过ARP获取目标机MAC，最终也是通过广播形式将数据包发送给接收方。而完成这个路由协议的物理设备就是[路由器](https://baike.baidu.com/item/路由器/108294)，路由器扮演着交通枢纽的角色，它会根据信道情况，选择并设定路由，以最佳路径来转发数据包。 [4] 

所以，网络层的主要工作是定义网络地址、区分网段、子网内MAC寻址、对于不同子网的数据包进行路由。 [4] 



### 传输层

链路层定义了主机的身份，即MAC地址，而网络层定义了IP地址，明确了主机所在的[网段](https://baike.baidu.com/item/网段/11026985)，有了这两个地址，数据包就从可以从一个主机发送到另一台主机。但实际上数据包是从一个主机的某个应用程序发出，然后由对方主机的应用程序接收。而每台电脑都有可能同时运行着很多个应用程序，所以当数据包被发送到主机上以后，是无法确定哪个应用程序要接收这个包。因此传输层引入了[UDP](https://baike.baidu.com/item/UDP/571511)协议来解决这个问题，为了给每个应用程序标识身份。

**UDP协议**

UDP协议定义了端口，同一个主机上的每个应用程序都需要指定唯一的端口号，并且规定网络中传输的数据包必须加上端口信息，当数据包到达主机以后，就可以根据端口号找到对应的应用程序了。UDP协议比较简单，实现容易，但它没有确认机制，数据包一旦发出，无法知道对方是否收到，因此可靠性较差，为了解决这个问题，提高网络可靠性，TCP协议就诞生了。

**TCP协议**

TCP即传输控制协议，是一种面向连接的、可靠的、基于字节流的通信协议。简单来说TCP就是有确认机制的UDP协议，每发出一个数据包都要求确认，如果有一个数据包丢失，就收不到确认，发送方就必须重发这个数据包。为了保证传输的可靠性，TCP协议在UDP基础之上建立了三次对话的确认机制，即在正式收发数据前，必须和对方建立可靠的连接。TCP数据包和UDP一样，都是由首部和数据两部分组成，唯一不同的是，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。 [4] 

传输层的主要工作是定义[端口](https://baike.baidu.com/item/端口/103505)，标识应用程序身份，实现端口到端口的通信，TCP协议可以保证数据传输的可靠性。 [4] 



### 应用层

理论上讲，有了以上三层协议的支持，数据已经可以从一个主机上的应用程序传输到另一台主机的应用程序了，但此时传过来的数据是字节流，不能很好的被程序识别，操作性差，因此，应用层定义了各种各样的协议来规范数据格式，常见的有[http](https://baike.baidu.com/item/http/243074),ftp,[smtp](https://baike.baidu.com/item/smtp/175887)等，在请求[Header](https://baike.baidu.com/item/Header/688992)中，分别定义了请求数据格式Accept和响应数据格式Content-Type，有了这个规范以后，当对方接收到请求以后就知道该用什么格式来解析，然后对请求进行处理，最后按照请求方要求的格式将数据返回，请求端接收到响应后，就按照规定的格式进行解读。 [4] 

所以应用层的主要工作就是定义数据格式并按照对应的格式解读数据。 [4] 