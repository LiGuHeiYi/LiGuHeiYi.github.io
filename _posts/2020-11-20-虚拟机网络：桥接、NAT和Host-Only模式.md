---
layout: post
title: 虚拟机网络：桥接、NAT和Host-Only模式
date: 2020-11-20
categories: blog
tags: [web,虚拟机]
description: 虚拟机网络知识
typora-copy-images-to: ..\img
typora-root-url: ..
---

# 虚拟机网络：桥接、NAT和Host-Only模式

![image-20201120131717280](E:\文档\Github仓库\LiGuHeiYi\LiGuHeiYi.github.io\img\image-20201120131717280.png)

上面这张图就是vmware虚拟网络编辑器上可以选择的三种虚拟机的网络模式：桥接，NAT和仅主机（Host-Only）

## 桥接

桥接模式就是VMware通过VMnet0虚拟交换机将物理网卡和虚拟网卡进行桥接，“桥接”就是在数据链路层上将两个网络拼接起来的技术（桥接器，交换机）。这样物理网卡和虚拟网卡在网络拓扑上地位相等，也就是相当于在一个网段，物理网卡和虚拟网卡的ip地址在一个局域网里。这里可以让VMware自动设置，也可以手动设置虚拟网卡的ip地址，让它不会和局域网内的其它联网设备ip冲突。

这是物理机通过局域网ip访问本地网站（phpstudy默认主页），局域网ip为：192.168.0.106

![](/img/image-20201121121534108.png)

这是ubuntu虚拟机通过局域网ip访问虚拟机本地网站（apache2默认主页），局域网ip为：192.168.0.107（这个ip紧跟物理机ip，它们在一个网段）

![image-20201121123258281](/img/image-20201121123258281.png)

接下来放两张它们互相访问的图

![image-20201121123534968](/img/image-20201121123534968.png)

![image-20201121123559732](/img/image-20201121123559732.png)

这就很直观了



## NAT

NAT英文全称是“Network Address Translation”，中文意思是“网络地址转换”，它是一个IETF(Internet Engineering Task  Force, Internet工程任务组)标准，允许一个整体机构以一个公用IP（Internet  Protocol）地址出现在Internet上。顾名思义，它是一种把内部私有网络地址（IP地址）翻译成合法网络IP地址的技术。

通俗的讲，NAT可以使一个局域网中所有主机对外使用一个公网ip，对内使用不同私有ip。其实就是我们现在使用的绝大部分无线路由器默认开启的功能，这就是为什么我们能使用多台设备连接到一个WiFi上，并使用一个“宽带”原因。

虚拟机的NAT模式下，我们的物理机就相当于这样以一个路由器，在虚拟机之间组成了一个“虚拟局域网”，所有NAT模式下的虚拟机拥有一个它们自己独有的，比物理机的私有ip更次一级的私有ip。

它们之间可以通过这个“更次一级的私有ip”互相访问，

kali虚拟机的ip为 192.168.197.129

![kali虚拟机ip](/img/image-20201121125655138.png)

ubuntu虚拟机的ip为192.168.197.128，并访问kali的本地网站成功

![ubuntu访问kali主页](/img/image-20201121125922772.png)

**但如果想要使物理机或局域网甚至外网访问虚拟机，必须在虚拟网络编辑器中设置静态端口映射**，这在上一篇博客中已经写过了

### NAT技术类型

 

　　NAT有三种类型：静态NAT(Static NAT)、动态地址NAT(Pooled NAT)、网络地址端口转换NAPT（Port－Level NAT）。

 		根据不同的需要，三种NAT方案各有利弊。



　　**静态NAT**设置起来是最为简单和最容易实现的一种，内部网络中的每个主机都被永久映射成外部网络中的某个合法的地址。而动态地址NAT则是在外部网络中定义了一系列的合法地址，采用动态分配的方法映射到内部网络。NAPT则是把内部地址映射到外部网络的一个IP地址的不同端口上。根据不同的需要，三种NAT方案各有利弊。

 

　　**动态地址NAT**只是转换IP地址，它为每一个内部的IP地址分配一个**临时的外部IP地址**，主要应用于拨号，对于频繁的远程联接也可以采用动态NAT。当远程用户联接上之后，动态地址NAT就会分配给他一个IP地址，用户断开时，这个IP地址就会被释放而留待以后使用。

 

　　**网络地址端口转换NAPT**（Network Address Port  Translation）是人们比较熟悉的一种转换方式（也就是上一篇文章写的设置静态端口映射的方式）。NAPT普遍应用于接入设备中，它可以将中小型的网络隐藏在一个合法的IP地址（私有或公有都行）后面。NAPT与动态地址NAT不同，它将内部连接映射到外部网络中的一个**单独的IP地址**上，同时在该地址上加上一个由NAT设备选定的TCP端口号。

## **Host-Only**

 在Host-Only模式下，虚拟网络是一个全封闭的网络，它唯一能够访问的就是主机。其实Host-Only网络和NAT网络很相似，不同的地方就是Host-Only网络没有NAT服务，所以虚拟网络不能连接到Internet。主机和虚拟机之间的通信是通过VMware Network Adepter VMnet1虚拟网卡来实现的。

　　Host-Only的宗旨就是建立一个与外界隔绝的内部网络，来提高内网的安全性。这个功能或许对普通用户来说没有多大意义，但大型服务商会常常利用这个功能。如果你想为VMnet1网段提供路由功能，那就需要使用RRAS，而不能使用XP或2000的ICS，因为ICS会把内网的IP地址改为192.168.0.1，但虚拟机是不会给VMnet1虚拟网卡分配这个地址的，那么主机和虚拟机之间就不能通信了。