---
layout: post
title: 版本控制系统信息泄露分析
date: 2021-1-14
categories: blog
tags: [ctf,web]
description: 详解ctf中的版本控制系统信息泄露分析过程
typora-copy-images-to: ..\img
typora-root-url: ..
---
# 版本控制系统信息泄露分析

## .svn文件

.svn文件是 Subversion系统的版本控制信息文件，当某个目录处于subversion的版本控制i时，在这个目录中就会.svn这个文件夹，这个.svn文件夹中的文件就是一些版本信息文件。

黑客可以借助其中包含的用于版本信息追踪的‘entries’文件，逐步摸清站点结构。”（可以利用.svn/entries文件，获取到服务器源码、svn服务器账号密码等信息）

更严重的问题在于，SVN产生的.svn目录下还包含了以.svn-base结尾的源代码文件副本（低版本SVN具体路径为text-base目录，高版本SVN为pristine目录），如果服务器没有对此类后缀做解析，黑客则可以直接获得文件源代码。

**系统中没有Subversion的情况下：**手工查找。

多半是去寻找项目的源代码，那么就去寻找**以.svn-base结尾的源代码文件副本（低版本SVN具体路径为text-base目录，高版本SVN为pristine目录）**，或者也可以先读一读entries文件，直接用记事本打开就行，如果方法得当，就能节省不少时间。

**系统中有Subversion的情况下：**先用命令查找一遍

- **svn log:** 用来展示svn 的版本作者、日期、路径等等。
- **svn diff:** 用来显示特定修改的行级详细信息。
- **svn cat:** 取得在特定版本的某文件显示在当前屏幕。
- **svn list:** 显示一个目录或某一版本存在的文件。

------

### 1、svn log

可以显示所有的信息，如果只希望查看特定的某两个版本之间的信息，可以使用：

```
root@runoob:~/svn/runoob01/trunk# svn log -r 6:8
------------------------------------------------------------------------
r6 | user02 | 2016-11-07 02:01:26 +0800 (Mon, 07 Nov 2016) | 1 line

change HelloWorld.html first.
------------------------------------------------------------------------
r7 | user01 | 2016-11-07 02:23:26 +0800 (Mon, 07 Nov 2016) | 1 line

change HelloWorld.html second
------------------------------------------------------------------------
r8 | user01 | 2016-11-07 02:53:13 +0800 (Mon, 07 Nov 2016) | 1 line

SVN readme.
------------------------------------------------------------------------
```

如果只想查看某一个文件的版本修改信息，可以使用 **svn log** 文件路径。

```
root@runoob:~/svn/runoob01# svn log trunk/HelloWorld.html 
------------------------------------------------------------------------
r7 | user01 | 2016-11-07 02:23:26 +0800 (Mon, 07 Nov 2016) | 1 line

change HelloWorld.html second
------------------------------------------------------------------------
r6 | user02 | 2016-11-07 02:01:26 +0800 (Mon, 07 Nov 2016) | 1 line

change HelloWorld.html first.
------------------------------------------------------------------------
r5 | user01 | 2016-11-07 01:50:03 +0800 (Mon, 07 Nov 2016) | 1 line


------------------------------------------------------------------------
r4 | user01 | 2016-11-07 01:45:43 +0800 (Mon, 07 Nov 2016) | 1 line

Add function to accept input and to display array contents
------------------------------------------------------------------------
r3 | user01 | 2016-11-07 01:42:35 +0800 (Mon, 07 Nov 2016) | 1 line


------------------------------------------------------------------------
r2 | user01 | 2016-08-23 17:29:02 +0800 (Tue, 23 Aug 2016) | 1 line

first file
------------------------------------------------------------------------
```

如果希望得到目录的信息要加 **-v**。

如果希望显示限定N条记录的目录信息，使用 `svn log -l N -v`。

```
root@runoob:~/svn/runoob01/trunk# svn log -l 5 -v 
------------------------------------------------------------------------
r6 | user02 | 2016-11-07 02:01:26 +0800 (Mon, 07 Nov 2016) | 1 line
Changed paths:
   M /trunk/HelloWorld.html

change HelloWorld.html first.
------------------------------------------------------------------------
r5 | user01 | 2016-11-07 01:50:03 +0800 (Mon, 07 Nov 2016) | 1 line
Changed paths:
   M /trunk/HelloWorld.html


------------------------------------------------------------------------
r4 | user01 | 2016-11-07 01:45:43 +0800 (Mon, 07 Nov 2016) | 1 line
Changed paths:
   M /trunk/HelloWorld.html

Add function to accept input and to display array contents
------------------------------------------------------------------------
r3 | user01 | 2016-11-07 01:42:35 +0800 (Mon, 07 Nov 2016) | 1 line
Changed paths:
   A /trunk/HelloWorld.html (from /trunk/helloworld.html:2)
   D /trunk/helloworld.html


------------------------------------------------------------------------
r2 | user01 | 2016-08-23 17:29:02 +0800 (Tue, 23 Aug 2016) | 1 line
Changed paths:
   A /trunk/helloworld.html

first file
------------------------------------------------------------------------
```

------

### 2、svn diff

用来检查历史修改的详情。

- 检查本地修改
- 比较工作拷贝与版本库
- 比较版本库与版本库

**（1）、如果用 svn diff，不带任何参数，它将会比较你的工作文件与缓存在 .svn 的"原始"拷贝。**

```
root@runoob:~/svn/runoob01/trunk# svn diff
Index: rules.txt
===================================================================
--- rules.txt (revision 3)
+++ rules.txt (working copy)
@@ -1,4 +1,5 @@
Be kind to others
Freedom = Responsibility
Everything in moderation
-Chew with your mouth open
```

**（2）、比较工作拷贝和版本库**

比较你的工作拷贝和版本库中版本号为 3 的文件 rule.txt。

```
svn diff -r 3 rule.txt
```

**（3）、比较版本库与版本库**

通过 -r(revision) 传递两个通过冒号分开的版本号，这两个版本会进行比较。

比较 svn 工作版本中版本号2和3的这个文件的变化。

```
svn diff -r 2:3 rule.txt
```

------

### 3、svn cat

如果只是希望检查一个过去版本，不希望查看他们的区别，可使用svn cat

```
svn cat -r 版本号 rule.txt
```

这个命令会显示在该版本号下的该文件内容

------

### 4、svn list

s**vn list** 可以在不下载文件到本地目录的情况下来察看目录中的文件：

```
$ svn list http://192.168.0.1/runoob01
README
branches/
clients/
tags/
```

### SVN 版本回退

------

当我们想放弃对文件的修改，可以使用 **SVN revert** 命令。

svn revert 操作将撤销任何文件或目录里的局部更改。

我们对文件 readme 进行修改,查看文件状态。



```
root@runoob:~/svn/runoob01/trunk# svn status
M       readme
```

这时我们发现修改错误，要撤销修改，通过 svn revert 文件 readme 回归到未修改状态。

```
root@runoob:~/svn/runoob01/trunk# svn revert readme 
Reverted 'readme'
```

再查看状态。

```
root@runoob:~/svn/runoob01/trunk# svn status 
root@runoob:~/svn/runoob01/trunk# 
```

进行 revert 操作之后，readme 文件恢复了原始的状态。 revert 操作不单单可以使单个文件恢复原状， 而且可以使整个目录恢复原状。恢复目录用 -R 命令，如下。

```
svn revert -R trunk
```

但是，假如我们想恢复一个已经提交的版本怎么办。

为了消除一个旧版本，我们必须撤销旧版本里的所有更改然后提交一个新版本。这种操作叫做 reverse merge。

首先，找到仓库的当前版本，现在是版本 22，我们要撤销回到之前的版本，比如版本 21。

```
svn merge -r 22:21 readme 
```



## .git文件

Git泄露上一篇博客将得挺清楚了，一般ctf中会遇到的问题都有了，如果将来写题遇到什么有趣的、有用的东西再记录一下，这里贴一些git常用命令吧，也是实用的东西。

**创建分支命令：**

```
git branch (branchname)			//创建一个叫branchname的分支
```

**列出分支命令：**

```
git branch
```

没有参数时，`git branch` 会列出你在本地的分支。

```
$ git branch
* master
```

此例的意思就是，我们有一个叫做 **master** 的分支，并且该分支是当前分支。

当你执行 **git init** 的时候，默认情况下 Git 就会为你创建 **master** 分支。

**切换分支命令:**

```
git checkout (branchname)
```

当你切换分支的时候，Git 会用该分支的最后提交的快照替换你的工作目录的内容， 所以多个分支不需要多个目录。

上一篇提到了一个`git checkout-index`命令，就是将index索引中的文件”切换“出来，切换到当前工作目录。

**合并分支命令:**

```
git merge 
```

一旦某分支有了独立内容，你终究会希望将它合并回到你的主分支。

```bash
$ git branch
* master
  newtest
$ ls
README        test.txt
$ git merge newtest
Updating 3e92c19..c1501a2
Fast-forward
 xxx.php | 0
 test.txt   | 1 -
 2 files changed, 1 deletion(-)
 create mode 100644 xxx.php
 delete mode 100644 test.txt
$ ls
README        xxx.php
```

以上实例中我们将 newtest 分支合并到主分支去，test.txt 文件被删除。

合并完后就可以删除分支:

**删除分支命令：**

```bash
git branch -d (branchname)		//删除名为branchname的分支
```

```
$ git branch -d newtest
Deleted branch newtest (was c1501a2).
```

删除后， 就只剩下 master 分支了：

```bash
$ git branch
* master
```



## WEB-INF/web.xml

WEB-INF是Java的WEB应用的安全目录。如果想在页面中直接访问其中的文件，必须通过web.xml文件对要访问的文件进行相应映射才能访问。WEB-INF主要包含一下文件或目录：

```
 /WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。 

  /WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中   

  /WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件  

  /WEB-INF/src/：源码目录，按照包名结构放置各个java文件。

  /WEB-INF/database.properties：数据库配置文件

```

漏洞成因：

​	通常一些web应用我们会使用多个web服务器搭配使用，解决其中的一个web服务器的性能缺陷以及做均衡负载的优点和完成一些分层结构的安全策略等。在使用这种架构的时候，由于对静态资源的目录或文件的映射配置不当，可能会引发一些的安全问题，导致web.xml等文件能够被读取。

**漏洞检测以及利用方法**：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码。

但是具体情况具体分析，实际场景下还是要尽量发挥随机应变的能力。